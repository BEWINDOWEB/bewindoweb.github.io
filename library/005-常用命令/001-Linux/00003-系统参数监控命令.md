# 系统参数监控命令

## Debian
> 测试通过：
> * debian 8.x

#### 查看内存占用信息
```
free -h
```
![](assets/005/20190619-4c941158.png)  

| -参数 | --参数 |  含义 |
| ---- | ---- | ---- |
| -b | --bytes | 用字节显示数据 |
| -k | --kilo | 用KB显示数据 |
| -m | --mega | 用MB显示数据 |
| -g | --giga | 用GB显示数据 |
| | --tera | 用TB显示数据 |
| -h | --human | 可读性好地显示数据 |
| | --si | 按1000来计算而不是1024 |
| -l | --lohi | 显示最低、最高内存占用的统计数据 |
| -o | --old | 用旧格式显示（没有-/+buffers/cache这行） |
| -t | --total | 显示内存RAM+SWAP，和Total数据 |
| -s N | --seconds N | 每隔N秒打印一次 |
| -c N | --count N | 打印N次后退出 |

#### 查看进程信息
```
top
```
结果截图：
![](assets/005/20190619-6046da77.png)  
```
top - 22:35:50 up  1:44,  1 user,  load average: 0.16, 0.07, 0.02
Tasks:  81 total,   1 running,  80 sleeping,   0 stopped,   0 zombie
%Cpu(s):  0.3 us,  0.3 sy,  0.0 ni, 99.3 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
KiB Mem:   1024052 total,   525352 used,   498700 free,    33428 buffers
KiB Swap:        0 total,        0 used,        0 free.   333088 cached Mem

  PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND                                                                 
 1014 root      20   0  390688  38612  24612 S  0.3  3.8   0:06.00 docker-containe                                                         
    1 root      20   0   28900   5244   3148 S  0.0  0.5   0:02.02 systemd                                                                 
    2 root      20   0       0      0      0 S  0.0  0.0   0:00.00 kthreadd                                                                
    3 root      20   0       0      0      0 S  0.0  0.0   0:00.13 ksoftirqd/0                                                             
    5 root       0 -20       0      0      0 S  0.0  0.0   0:00.00 kworker/0:0H                                                            
    6 root      20   0       0      0      0 S  0.0  0.0   0:00.00 kworker/u2:0        
```
类似于Windows任务管理器，默认每隔3秒更新一次，其中    
**（1）顶部参数解释**  
【系统运行时间和平均负载】  

| 信息 | 解释 |
| ---- | ---- |
| 22:35:50 | 当前系统时间 |
| 1:44 | 系统运行了1小时44分钟 |
| 1 user | 当前有1个用户登录系统 |
| load average | 5分钟、10分钟、15分钟的CPU负载情况，也就是运维常见的load5、load10、load15，数据是每隔5秒钟检查一次活跃的进程数，然后按特定算法计算出的数值。如果这个数除以逻辑CPU的数量，结果高于5的时候就表明系统在超负荷运转了 |

【任务】（Tasks）  

| 信息 | 解释 |
| ---- | ---- |
| 81 total | 一共81个进程 |
| 1 running | 1个运行态 |
| 80 sleeping | 80个休眠态 |
| 0 stopped | 0个停止态 |
| 0 zombie | 0个僵尸态 |

【CPU状态】（CPUs）  
| 信息 | 解释 |
| ---- | ---- |
| us | user，运行用户进程的CPU时间 |
| sy | system，运行内核进程的CPU时间 |
| ni | niced，运行已调整优先级的用户进程的CPU时间 |
| wa | IO wait，用于等待IO完成的CPU时间 |
| hi | Hardware IRQ，处理硬件中断的CPU时间 |
| si | Software Interrupts，处理软件中断的CPU时间 |
| st | 虚拟机被hypervisor偷去的CPU时间，表明你的系统花了百分之多少等待得到真正的cpu资源，最好为0，表明vm得到了所有CPU资源，如果为50，表明vm需要CPU时有一半时间在等待，如果为100，表明vm花费100%的时间等待真实的CPU资源 |


**（2）显示面板的含义**  

| 序号 | 列名 | 全名 | 含义 | 备注 |
| ---- | --- | ---- | ---- |
| a | PID | Process Id | 进程ID | |
| b | PPID | Parent Process pid | 父进程ID | |
| c | RUSER | Real User Name | 真实用户名 | |
| d | UID | Effective User Id | | |
| e | USER | Effective User Name | 进程所有者 | |
| f | GROUP | Group Name | 进程所有者的组名 | |
| g | TTY | Controlling Tty | 启动进程的终端名，不是从终端启动的进程则显示为？ | |
| h | PR | Priority | 进程优先级 | |
| i | NI | Nice Value | Nice值，越小（可以是负值）优先级越高 | |
| j | P | Last Used Cpu (SMP) | 最后使用的CPU，仅在多核CPU下有意义 | |
| k | %CPU | CPU Usage | CPU使用率 | |
| l | TIME | CPU Time | 进程总共占用的CPU时间，单位秒 | |
| m | TIME+ | CPU Time, hundredths | 进程总共占用的CPU时间，单位1/100秒 | |
| n | %MEM | Memory Usage (RES) | 物理内存占用 | |
| o | VIRT | Virtual Image (KiB) | 进程虚拟内存大小 | |
| p | SWAP | Swapped Size (KiB) | 进程使用的虚拟内存中，被换出的大小 | |
| q | RES | Resident Size (KiB) | 进程使用的、未被换出的物理内存大小：常驻内存大小，RES=CODE+DATA | |
| r | CODE | Code Size (KiB) | 可执行代码占用的物理内存大小 | |
| s | DATA | Data+Stack (KiB) | 数据段+栈占用的物理内存大小 | |
| t | SHR | Shared Memory (KiB) | 和其他进程共享的物理内存空间 | |
| u | nFLT | Fault Pages Count | 页面错误次数 | |
| v | nDRT | Dirty Pages Count | 最后一次写入到现在，被修改过的页面数 | |
| w | S | Process Status | 进程状态 | S=休眠态，R=运行态，T=跟踪/停止态，D=不可中断的休眠态， Z=僵尸进程 |
| x | COMMAND | Command Name/Line | 运行进程的命令 | |
| y | WCHAN | Sleeping in Function | 若该进程在睡眠，则显示睡眠中的系统函数名 | |
| z | Flags | Task Flags <sched.h> | 任务标志，参考sched.h | |
| | RUID | Real User Id | 真实用户ID | |
| | SUID | Saved User Id | | |
| | SUSER  | Saved User Name | | |
| | GID | Group Id | | |
| | PGRP | Process Group Id | | |
| | TPGID | Tty Process Grp Id | | |
| | SID | Session Id | | |
| | nTH | Number of Threads | | |
| | nMaj | Major Page Faults | | |
| | nMin | Minor Page Faults | | |
| | CGROUPS | Control Groups | | |
| | SUPGIDS | Supp Groups IDs | | |
| | SUPGRPS | Supp Groups Names | | |
| | TGID | Thread Group Id | | |
| | ENVIRON | Environment vars | | |
| | vMj | Major Faults delta | | |
| | vMn | Minor Faults delta | | |
| | USED | Res+Swap Size (KiB) | | |
| | nsIPC | IPC namespace Inode | | |
| | nsMNT | MNT namespace Inode | | |
| | nsNET | NET namespace Inode | | |
| | nsPID | PID namespace Inode | | |
| | nsUSER | USER namespace Inode | | |
| | nsUTS | UTS namespace Inode | | |

**（3）常用命令**  
指的进入top后再按键的命令，不是top的运行参数，区分大小写。  

| 命令 | 作用 | 备注 |
| ---- | --- | ---- |
| s | 改变刷新数据时间间隔 | |
| l | 是否显示第一行数据 | 决定是否显示 top …… 这一行的数据 |
| t | 是否显示总的统计数据 | 决定是否显示 Tasks：…… Cpu(s)：…… 这两行的数据 |
| m | 是否显示内存信息 | 决定是否显示 Mem：…… Swap：…… 这两行的数据 |
| N | 以PID的大小排序显示 | |
| P | 以CPU占用率大小排序显示 | |
| M | 以内存占用率大小排序显示 | |
| n | 设置进程列表显示进程的数量 | |
| A | 单窗口/多窗口切换 | 可以通过a或w来切换窗口，窗口名为Def，Job，Mem，Usr |
| f | 配置top面板 | 可以配置面板展示哪些列，按空格选择，s保存，ESC退出 |
| o | 调整列顺序 | |
| r | 使用renice命令调整进程优先级 | |
| k | 使用kill命令杀掉进程 | |
| h | 显示帮助 | |
| q | 退出top | |

**（4）常用运行参数**

| 参数 | 作用 | 备注 |
| ---- | --- | ---- |
| -b | 批量处理模式 | 每次刷新不会冲掉旧数据 |
| -p [pid1,pid2] | 只显示某个/多个进程的信息 | |
| -u [username] | 只显示某个用户的进程信息 | |
| -H | 显示线程信息而不是进程信息 | |
| -d [ntime] | 设置刷屏时间（秒） | |
